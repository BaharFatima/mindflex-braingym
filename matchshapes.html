

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MindFlex - Match Shapes</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#E5E7EB;
  font-family:'Poppins',sans-serif;
}

.note {
  font-size: 10px;
  color: #353639;
  background: #E3F2FD;
  padding: 6px 8px;
  border-radius: 10px;
  margin-bottom: 8px;
  text-align: center;
  border: 1px solid #BBDEFB;
}
.app{
  width:320px;
  height:640px;
  background:linear-gradient(180deg,#a0c9ec,#AFC4D6);
  border-radius:32px;
  box-shadow:0 30px 60px rgba(0,0,0,0.25);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
}

/* Decorative soft circles */
.app::before{
  content:"";
  position:absolute;
  width:180px;
  height:180px;
  background:rgba(255,255,255,0.2);
  border-radius:50%;
  top:-60px;
  right:-60px;
}

.app::after{
  content:"";
  position:absolute;
  width:140px;
  height:140px;
  background:rgba(255,255,255,0.15);
  border-radius:50%;
  bottom:-50px;
  left:-40px;
}

/* HEADER BAR */
.header-bar{
  height:70px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  color:#3e61b2;
  font-weight:600;
  font-size:18px;
}

.back-btn{
  position:absolute;
  top:20px;
  left:20px;
  width:36px;
  height:36px;
  border-radius:12px;
  background:rgba(255,255,255,0.6);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
}

/* LEVEL */
.level{
  text-align:center;
  font-size:24px;
  font-weight:700;
  color:#3e61b2;
  margin-top:5px;
}

/* QUESTION */
.question{
  text-align:center;
  font-size:16px;
  font-weight:500;
  color:#3e61b2;
  margin-top:5px;
}

/* GAME CARD */
.game{
  flex:1;
  margin:20px;
  background:rgba(255,255,255,0.6);
  backdrop-filter:blur(10px);
  border-radius:24px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  box-shadow:0 15px 30px rgba(0,0,0,0.15);
}

.row{
  display:flex;
  gap:20px;
  margin:18px 0;
}

.shape{
  width:90px;
  height:90px;
  border-radius:28px;
  cursor:pointer;
  box-shadow:
    0 8px 18px rgba(0,0,0,0.25),
    inset 0 2px 6px rgba(255,255,255,0.4);
  transition:.2s ease;
}

.shape:hover{
  transform:translateY(-4px) scale(1.05);
}

.correct{
  outline:4px solid #22C55E;
}

.wrong{
  animation:shake .3s;
}

@keyframes shake{
  0%,100%{transform:translateX(0);}
  25%{transform:translateX(-8px);}
  50%{transform:translateX(8px);}
  75%{transform:translateX(-8px);}
}

/* NEXT BUTTON */
#next{
  margin:15px auto 20px;
  background:#3e61b2;
  color:white;
  border:none;
  border-radius:22px;
  padding:12px 28px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  display:none;
  box-shadow:0 8px 20px rgba(62,97,178,0.4);
}


</style>
</head>
<body>
<div class="app"> 
    <div class = "header-bar">  </div>
<div class="back-btn" onclick="window.location.href='../focuslab.html'">‚Üê</div>
<p class="note">
  Note: Match the shape with the color of its name.

  </p>
<div class="level" id="levelText">LEVEL 1</div>
<div class="question" id="questionText"></div>

<div class="game">
  <div class="row" id="rowTop"></div>
  <div class="row" id="rowBottom"></div>
</div>

<button id="next">Next Level</button>

</div>

<script type="module">
import { addXP } from "../xp.js";
import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* üî• PUT YOUR FIREBASE CONFIG */
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
 apiKey: "AIzaSyD9bnmF1N44Nkuk3WZQjK9z4gRE00VRmCY",
  authDomain: "mindflex-b2a0c.firebaseapp.com",
  projectId: "mindflex-b2a0c",
  storageBucket: "mindflex-b2a0c.firebasestorage.app",
  messagingSenderId: "148676867562",
  appId: "1:148676867562:web:3365a72b6fa6b3751cee93",
  measurementId: "G-Q2T6HD3S0E"
};


const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
let currentUser = null;




/* GAME STATE */
let level = 1;
let correctClicks = 0;
let wrongClicks = 0;
let totalAttempts = 0;

const shapes = ['circle','square','triangle','diamond'];
const colors = ['#2196F3','#E91E63','#4CAF50','#FF9800'];

const rowTop=document.getElementById('rowTop');
const rowBottom=document.getElementById('rowBottom');
const levelText=document.getElementById('levelText');
const questionText=document.getElementById('questionText');
const nextBtn=document.getElementById('next');

function randomItem(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

function clip(shape){
  switch(shape){
    case 'circle': return 'circle(50%)';
    case 'triangle': return 'polygon(50% 0%,0% 100%,100% 100%)';
    case 'diamond': return 'polygon(50% 0%,100% 50%,50% 100%,0% 50%)';
    default: return 'none';
  }
}

async function loadProgress(){
  const ref = doc(db,"users",currentUser.uid,"games","matchShapes");
  const snap = await getDoc(ref);
  if(snap.exists()){
   const data = snap.data();
    if(data){
      level = data.level || 1;
      correctClicks = data.correctClicks || 0;
      wrongClicks = data.wrongClicks || 0;
      totalAttempts = data.totalAttempts || 0;
    }
  }
  levelText.textContent = "LEVEL " + level;
  generateLevel();
}

async function saveProgress(){
  const accuracy = totalAttempts === 0 ? 0 :
      ((correctClicks/totalAttempts)*100).toFixed(2);

  await setDoc(
  doc(db,"users",currentUser.uid,"games","matchShapes"),
 {
  level,
  correctClicks,
wrongClicks,
  totalAttempts,
  accuracy,
  lastPlayed: new Date()
  },{merge:true});
}
function generateLevel(){
  nextBtn.style.display="none";
  rowTop.innerHTML="";
  rowBottom.innerHTML="";

  const targetShape=randomItem(shapes);
  const targetColor=randomItem(colors);

  questionText.innerHTML =
    `Find the <span style="color:${targetColor}">${targetShape.toUpperCase()}</span>`;

  const correctIndex=Math.floor(Math.random()*4);

  for(let i=0;i<4;i++){
    let s,c;

    if(i===correctIndex){
      s=targetShape; 
      c=targetColor;
    }else{
      do{
        s=randomItem(shapes);
        c=randomItem(colors);
      }while(s===targetShape && c===targetColor);
    }

    const div=document.createElement("div");
    div.className="shape";
    div.style.background=c;
    div.style.clipPath=clip(s);

    div.onclick = async () => {
      totalAttempts++;

      if(s===targetShape && c===targetColor){
        correctClicks++;
        div.classList.add("correct");

        await addXP(db, currentUser, 3);
        nextBtn.style.display="block";
      } else {
        wrongClicks++;
        div.classList.add("wrong");
        setTimeout(()=>div.classList.remove("wrong"),300);
      }
    };

    // ‚úÖ ADD SHAPE TO ROW
    if(i < 2){
      rowTop.appendChild(div);
    } else {
      rowBottom.appendChild(div);
    }
  }
}
nextBtn.onclick=async()=>{
 await addXP(db, currentUser, 5);
  level++;
  levelText.textContent="LEVEL "+level;
  await saveProgress();
  generateLevel();
};

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
    loadProgress();
  } else {
    alert("User not logged in");
  }
});

</script>

</body>
</html>
