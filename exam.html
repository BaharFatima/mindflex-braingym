<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Exam Timetables — Log</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>

  /* ========== BACK BUTTON ========== */
.back-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 1.6rem;
      cursor: pointer;
      color: #003366;
      font-weight: bold;
      text-decoration: none;
      z-index: 10;
    }

  *{box-sizing:border-box;margin:0;padding:0;font-family:"Poppins",sans-serif}
  body{height:100vh;background:linear-gradient(135deg,#d8eaff,#a6ccff);display:flex;align-items:center;justify-content:center;overflow:hidden}
  
  .main-wrapper {
    display: flex;
    flex-direction: column;
    width: 320px;
    height: 640px;
    gap: 0;
  }

  .container{width:100%;flex:1;background:#f8fbff;border-radius:20px 20px 0 0;box-shadow:0 18px 40px rgba(0,70,160,0.12);overflow:hidden;position:relative;display:flex;flex-direction:column}

  header{height:56px;display:flex;align-items:center;justify-content:center;color:#0f2b45;font-weight:700}
  main{flex:1;overflow:auto;padding:14px}

  .list-title{font-size:18px;margin-bottom:12px;color:#0f2b45;font-weight:700;text-align:center}
  .entries{display:flex;flex-direction:column;gap:10px}
  .entry-card{background:#e6f4ff;border-radius:12px;padding:12px;box-shadow:0 6px 14px rgba(0,0,0,0.03)}
  .entry-top{display:flex;justify-content:space-between;align-items:center}
  .entry-title{font-weight:700;color:#0f2b45}
  .entry-date{font-size:12px;color:#2e5a78}
  .entry-snippet{margin-top:8px;color:#234;opacity:.9;white-space:pre-wrap}

  .entry-actions{display:flex;gap:8px;margin-top:10px}
  .small-btn{padding:6px 8px;border-radius:8px;border:none;background:rgba(109,168,255,0.15);color:#6da8ff;cursor:pointer}

  .empty{color:#4b708f;text-align:center;margin-top:40px;opacity:.8}

  /* Floating Add Button */
  .fab {
    position:absolute;
    bottom:18px;
    right:18px;
    width:56px;
    height:56px;
    border-radius:50%;
    background:#5bb0ff;
    color:white;
    font-size:30px;
    border:none;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,0.18);
    z-index: 5;
  }

  /* Clear All button */
  .top-right {
    position:absolute;
    top:12px;
    right:12px;
    z-index: 10;
  }
  .clear-btn{padding:8px 10px;border-radius:10px;border:none;background:#ff8b8b;color:white;cursor:pointer}

  /* scrollbar */
  main::-webkit-scrollbar{width:10px}
  main::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.12);border-radius:10px}

  /* ========== NAVBAR STYLES ========== */
  .navbar-wrapper {
    width: 100%;
    height: 80px;
    background: white;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.08);
    padding: 10px 5px 15px 5px;
    display: flex;
    justify-content: space-around;
    align-items: center;
  }

  .menu-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 5px;
    position: relative;
    flex: 1;
    text-decoration: none;
    color: inherit;
  }

  .menu-icon {
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.3s ease;
    color: #5f6368;
  }

  .menu-icon i {
    font-size: 24px;
    transition: all 0.3s ease;
  }

  .menu-label {
    font-size: 10px;
    color: #5f6368;
    text-align: center;
    line-height: 1.2;
    font-weight: 600;
  }

  /* Pop-up effect when selected */
  .menu-item.selected .menu-icon i {
    transform: translateY(-8px) scale(1.2);
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  /* Specific colors for each menu item */
  .menu-item[data-category="cv"].selected .menu-icon i {
    color: #0D47A1;
  }

  .menu-item[data-category="achievements"].selected .menu-icon i {
    color: #9c27b0;
  }

  .menu-item[data-category="home"].selected .menu-icon i {
    color: #1565C0;
  }

  .menu-item[data-category="habit-tracker"].selected .menu-icon i {
    color: #ff4081;
  }

  .menu-item[data-category="user-account"].selected .menu-icon i {
    color: #00838F;
  }

  /* Custom image icon styling */
  .menu-icon img {
    width: 24px;
    height: 24px;
    transition: all 0.3s ease;
    object-fit: contain;
    filter: grayscale(100%) brightness(0.7);
    border-radius: 8px;
  }

  .menu-item.selected .menu-icon img {
    transform: translateY(-8px) scale(1.2);
    filter: grayscale(0%) brightness(1.1) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
    border-radius: 10px;
  }

  /* Special filter for CV icon */
  .menu-item[data-category="cv"].selected .menu-icon img {
    filter: grayscale(0%) brightness(1.1) drop-shadow(0 4px 8px rgba(13, 71, 161, 0.4));
  }

  /* Special filter for Habit Tracker */
  .menu-item[data-category="habit-tracker"].selected .menu-icon img {
    filter: grayscale(0%) brightness(1.1) drop-shadow(0 4px 8px rgba(255, 64, 129, 0.4));
  }

  /* Fallback icon styling */
  .menu-icon .fallback-icon {
    width: 24px;
    height: 24px;
    background-color: #5f6368;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-weight: bold;
    transition: all 0.3s ease;
  }

  .menu-item.selected .menu-icon .fallback-icon {
    background-color: #ff4081;
    transform: translateY(-8px) scale(1.2);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    border-radius: 10px;
  }

  .menu-item[data-category="cv"].selected .menu-icon .fallback-icon {
    background-color: #0D47A1;
  }

  @media (max-width: 320px) {
    .navbar-wrapper {
      height: 75px;
      padding: 8px 3px 12px 3px;
    }
    
    .menu-icon {
      width: 36px;
      height: 36px;
    }
    
    .menu-icon i {
      font-size: 20px;
    }
    
    .menu-icon img {
      width: 20px;
      height: 20px;
      border-radius: 6px;
    }
    
    .menu-icon .fallback-icon {
      width: 20px;
      height: 20px;
      border-radius: 6px;
    }
    
    .menu-item.selected .menu-icon .fallback-icon {
      border-radius: 8px;
    }
    
    .menu-label {
      font-size: 9px;
    }
  }

</style>
</head>
<body>

<div class="main-wrapper">
  <div class="container">
    
    <!-- Content Wrapper allows scrolling independently of the fixed Nav Bar -->
     <div class="left-header">
          <a href="Studyzone.html" class="back-btn">←</a>
          </div>
    <header>Exam Timetables</header>

    <main>
      <div class="list-title">Saved Exam Timetables</div>

      <div class="entries" id="entries"></div>

      <div class="empty" id="emptyMsg">No saved exam timetables yet. Tap + to add one.</div>
    </main>

    <div class="top-right">
      <button class="clear-btn" id="clearAllBtn">Clear All</button>
    </div>

    <button class="fab" id="fabAdd" title="New entry">+</button>
  </div>

  <!-- NAVBAR -->
  <div class="navbar-wrapper">
    <a href="cv.html" class="menu-item" data-category="cv">
      <div class="menu-icon">
        <img src="cv.png" alt="CV" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div class="fallback-icon" style="display: none;">
          <i class="fas fa-file-alt"></i>
        </div>
      </div>
      <div class="menu-label">CV</div>
    </a>
    
    <a href="achievements.html" class="menu-item" data-category="achievements">
      <div class="menu-icon">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="menu-label">Achievements</div>
    </a>
    
    <a href="home.html" class="menu-item" data-category="home">
      <div class="menu-icon">
        <i class="fas fa-home"></i>
      </div>
      <div class="menu-label">Home</div>
    </a>
    
    <a href="habit-tracker.html" class="menu-item" data-category="habit-tracker">
      <div class="menu-icon">
        <img src="https://z-cdn-media.chatglm.cn/files/a1979dda-a3e4-4b38-b0cf-00e4ad455277_pasted_image_1762936027415.png?auth_key=1862936037-6cc8a5a356484e1cb70a8f599e1f2ce8-0-496c548f3f7ef2ea6a808a3cc812dc2c" alt="Habit Tracker" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div class="fallback-icon" style="display: none;">
          <i class="fas fa-check"></i>
        </div>
      </div>
      <div class="menu-label">Habit Tracker</div>
    </a>
    
    <a href="account.html" class="menu-item" data-category="user-account">
      <div class="menu-icon">
        <i class="fas fa-user-circle"></i>
      </div>
      <div class="menu-label">Account</div>
    </a>
  </div>
</div>

<script>
(() => {
  const STORAGE_KEY = 'examTimetables_v1';
  const entriesEl = document.getElementById('entries');
  const emptyMsg = document.getElementById('emptyMsg');
  const fab = document.getElementById('fabAdd');
  const clearAllBtn = document.getElementById('clearAllBtn');

  function load() {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  }

  function save(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function render() {
    const data = load();
    entriesEl.innerHTML = '';
    if (!data || data.length === 0) {
      emptyMsg.style.display = 'block';
      return;
    }
    emptyMsg.style.display = 'none';

    data.forEach((e, i) => {
      const card = document.createElement('div');
      card.className = 'entry-card';

      const top = document.createElement('div');
      top.className = 'entry-top';
      top.innerHTML = `<div class="entry-title">${escapeHtml(e.title || 'Exam Timetable')}</div>
                       <div class="entry-date">${new Date(e.savedAt||Date.now()).toLocaleString()}</div>`;

      const snippet = document.createElement('div');
      snippet.className = 'entry-snippet';
      // show generated timetable text or a short preview
      snippet.textContent = (e.resultText || '').slice(0, 300) || 'Tap Open to view generated timetable.';

      const actions = document.createElement('div');
      actions.className = 'entry-actions';
      // Open (edit) button
      const openBtn = document.createElement('button');
      openBtn.className = 'small-btn';
      openBtn.textContent = 'Open';
      openBtn.onclick = () => {
        localStorage.setItem('editingExamIndex', i);
        window.location.href = 'exam-create.html';
      };
      // Delete button
      const delBtn = document.createElement('button');
      delBtn.className = 'small-btn';
      delBtn.textContent = 'Delete';
      delBtn.onclick = () => {
        if (!confirm('Delete this exam timetable?')) return;
        const d = load();
        d.splice(i,1);
        save(d);
        render();
      };

      actions.appendChild(openBtn);
      actions.appendChild(delBtn);

      card.appendChild(top);
      card.appendChild(snippet);
      card.appendChild(actions);

      entriesEl.appendChild(card);
    });
  }

  // helper
  function escapeHtml(s){
    return (s+'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  // Floating button -> create new entry (remove any existing editing index)
  fab.onclick = () => {
    localStorage.removeItem('editingExamIndex');
    window.location.href = 'exam-create.html';
  };

  // clear all entries
  clearAllBtn.onclick = () => {
    if (!confirm('Clear ALL saved exam timetables? This cannot be undone.')) return;
    localStorage.removeItem(STORAGE_KEY);
    render();
  };

  // Navbar menu item selection
  const menuItems = document.querySelectorAll('.menu-item');
  menuItems.forEach(item => {
    item.addEventListener('click', function(e) {
      // Allow navigation while still showing selection
      menuItems.forEach(i => i.classList.remove('selected'));
      this.classList.add('selected');
    });
  });

  // initial render
  render();
})();
</script>

</body>
</html>
