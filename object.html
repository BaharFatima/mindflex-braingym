
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emoji Spelling | MindFlex</title>

<style>
/* BASE */
body{
  margin:0;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#E5E7EB;
  font-family:'Poppins',sans-serif;
}

/* APP CONTAINER */
.app{
  width:320px;
  height:640px;
  border-radius:30px;
  background:linear-gradient(180deg,#BBDEFB 0%, #E3F2FD 100%);
  box-shadow:0 25px 60px rgba(0,0,0,0.25);
  display:flex;
  flex-direction:column;
  padding:18px;
  box-sizing:border-box;
  position:relative;
  overflow:hidden;
}

/* Decorative bubbles */
.app::before{
  content:"";
  position:absolute;
  width:200px;
  height:200px;
  border-radius:50%;
  background:rgba(255,255,255,0.25);
  top:-70px;
  right:-60px;
}

.app::after{
  content:"";
  position:absolute;
  width:170px;
  height:170px;
  border-radius:50%;
  background:rgba(255,255,255,0.18);
  bottom:-60px;
  left:-50px;
}

/* HEADER */
header{
  position:relative;
  text-align:center;
  margin-bottom:8px;
  z-index:2;
}

.back-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 1.6rem;
      cursor: pointer;
      color: #003366;
      font-weight: bold;
      text-decoration: none;
    }


.title{
  font-size:18px;
  font-weight:700;
  color:#0D47A1;
}

/* GAME CARD */
.appContainer{
  width:280px;
  height:620px;
  border-radius:30px;
  background:linear-gradient(180deg,#BBDEFB 0%, #E3F2FD 100%);
  box-shadow:0 25px 60px rgba(0,0,0,0.25);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
  padding:18px;
  box-sizing:border-box;
}

.stats{
  text-align:center;
}

.stats div{
  font-size:14px;
  font-weight:600;
  color:#0D47A1;
  margin:2px 0;
}


.emoji{
  font-size:90px;
}

/* INPUT */
input{
  width:85%;
  padding:12px;
  border-radius:14px;
  border:2px solid #64B5F6;
  text-align:center;
  font-size:16px;
  outline:none;
}

/* BUTTONS */
.primary-btn{
  width:70%;
  padding:12px;
  border:none;
  border-radius:18px;
  background:#1565C0;
  color:white;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
  box-shadow:0 8px 20px rgba(21,101,192,0.4);
  transition:.2s;
}

.primary-btn:hover{
  transform:scale(1.05);
}

#nextLevel{
  width:70%;
  padding:12px;
  border:none;
  border-radius:20px;
  background:#1E88E5;
  color:white;
  font-weight:600;
  align-self:center;
  margin-top:10px;
  display:none;
  box-shadow:0 8px 20px rgba(30,136,229,0.4);
  cursor:pointer;
  flex:none;
}
.game-center{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;   /* TRUE vertical centering */
  align-items:center;
  gap:20px;
}

</style>
</head>

<body>

<div class="app">

<header>
  <div class="left-header">
        <a href="focuslab.html" class="back-btn">‚Üê</a>
        </div>
  <div class="title">Emoji Spelling</div>
</header>

<div class="appContainer">

<div class="stats">
  <div id="score">Score: 0</div>
  <div id="levelBar">Level 1</div>
  <div id="questionNum">Object 1 / 10</div>
</div>

<div class="game-center">
  <div class="emoji" id="emoji">üçé</div>

  <input type="text" id="answer" placeholder="Type spelling here">
  <button class="primary-btn" id="submitBtn">Submit</button>
  <button class="primary-btn" id="nextLevelBtn" style="display:none;">
  Next Level 
</button>

</div>


</div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* üî• YOUR REAL FIREBASE CONFIG */
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
 apiKey: "AIzaSyD9bnmF1N44Nkuk3WZQjK9z4gRE00VRmCY",
  authDomain: "mindflex-b2a0c.firebaseapp.com",
  projectId: "mindflex-b2a0c",
  storageBucket: "mindflex-b2a0c.firebasestorage.app",
  messagingSenderId: "148676867562",
  appId: "1:148676867562:web:3365a72b6fa6b3751cee93",
  measurementId: "G-Q2T6HD3S0E"
};


const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
    loadProgress();
  } else {
    window.location.href = "../login.html"; // redirect if not logged in
  }
});

/* GAME DATA */
const QUESTIONS_PER_LEVEL = 5;

const questions = [
  {emoji:"üçé", answers:["apple"]},
  {emoji:"üçå", answers:["banana"]},
  {emoji:"üçá", answers:["grapes","grape"]},
  {emoji:"üê∂", answers:["dog"]},
  {emoji:"üê±", answers:["cat"]},
  {emoji:"üöó", answers:["car"]},
  {emoji:"üåô", answers:["moon"]},
  {emoji:"‚≠ê", answers:["star"]},
  {emoji:"‚ù§Ô∏è", answers:["heart"]},
  {emoji:"üéÅ", answers:["gift","present"]},
  {emoji:"üï∑", answers:["spider"]},
  {emoji:"ü¶â", answers:["owl"]},
  {emoji:"üêä", answers:["crocodile","alligator"]},
  {emoji:"‚åöÔ∏è", answers:["watch","clock"]},
  {emoji:"‚òéÔ∏è", answers:["phone","telephone"]},
  {emoji:"üéà", answers:["balloon"]},
  {emoji:"üìï", answers:["book"]},
  {emoji:"üèä‚Äç‚ôÄÔ∏è", answers:["swimming","swim"]},
  {emoji:"üéª", answers:["violin"]}
];

let score = 0;
let level = 1;
let currentIndex = 0;

/* DOM */
const emojiEl = document.getElementById("emoji");
const answerEl = document.getElementById("answer");
const scoreEl = document.getElementById("score");
const levelEl = document.getElementById("levelBar");
const questionNumEl = document.getElementById("questionNum");
const submitBtn = document.getElementById("submitBtn");
const nextBtn = document.getElementById("nextLevelBtn");

/* GLOBAL INDEX */
function getGlobalIndex(){
  return ((level - 1) * QUESTIONS_PER_LEVEL + currentIndex) % questions.length;
}


/* LOAD QUESTION */
function loadQuestion(){
  const globalIndex = getGlobalIndex();

  if(globalIndex >= questions.length){
    emojiEl.textContent = "üéâ";
    questionNumEl.textContent = "All Levels Complete!";
    submitBtn.disabled = true;
    nextBtn.style.display = "none";
    return;
  }

  emojiEl.textContent = questions[globalIndex].emoji;
  questionNumEl.textContent =
    "Object " + (currentIndex + 1) + " / " + QUESTIONS_PER_LEVEL;
}

/* UPDATE UI */
function updateUI(){
  scoreEl.textContent = "Score: " + score;
  levelEl.textContent = "Level " + level;
}

/* SAVE PROGRESS */
async function saveProgress(){
  if(!currentUser) return;

  await setDoc(
    doc(db, "users", currentUser.uid, "games", "emojiSpelling"),
    {
      score,
      level,
      currentIndex,
      lastPlayed: new Date()
    },
    { merge: true }
  );
}
/* LOAD PROGRESS */
async function loadProgress(){
  if(!currentUser) return;

  try{
    const snap = await getDoc(
      doc(db, "users", currentUser.uid, "games", "emojiSpelling")
    );

    if(snap.exists()){
      const data = snap.data();
      score = data.score || 0;
      level = data.level || 1;
      currentIndex = data.currentIndex || 0;
    }
  }catch(e){
    console.log("Load error:", e);
  }

  updateUI();
  loadQuestion();
}
/* SUBMIT ANSWER */
submitBtn.onclick = ()=>{
  const globalIndex = getGlobalIndex();

  if(globalIndex >= questions.length) return;

  const userAnswer = answerEl.value.trim().toLowerCase();
  const correctAnswers = questions[globalIndex].answers;

  if(correctAnswers.includes(userAnswer)){
    score += 10;
    currentIndex++;

    if(currentIndex < QUESTIONS_PER_LEVEL &&
       getGlobalIndex() < questions.length){
        answerEl.value = "";
        loadQuestion();
    } else {
        nextBtn.style.display = "block";
    }

    updateUI();
    saveProgress();
  } else {
    answerEl.value = "";
    answerEl.placeholder = "Try again!";
  }
};

/* NEXT LEVEL */
nextBtn.onclick = ()=>{
  level++;
  currentIndex = 0;
  nextBtn.style.display = "none";

  updateUI();
  loadQuestion();
  saveProgress();
};

/* INIT */
</script>
</body>
</html>
