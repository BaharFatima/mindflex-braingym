<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0" />
<title>Create Entry ‚Äî Journal</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* SAME STYLING AS ORIGINAL FILE --------------------------------------------------- */

:root{
  --bg1: #d8eaff;
  --bg2: #a6ccff;
  --card: #f8fbff;
  --light: #e6f4ff;
  --accent: #6da8ff;
  --accent-dark: #4f9aff;
  --text: #0f2b45;
}
html,body{
  height:100%;
  background: linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: "Poppins", system-ui;
}
/* Mobile frame */
.app {
  width: 320px;
  height: 640px;
  background: var(--card);
  border-radius: 20px;
  box-shadow: 0 18px 40px rgba(0,70,160,0.15);
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* HEADER */
header.app-header{
  height:56px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 14px;
  color: var(--text);
  font-weight:700;
}
header.app-header .left, header.app-header .right{width:36px;text-align:center}
header.app-header .center{font-size:18px}

/* SCROLL AREA */
main{
  flex:1;
  overflow:auto;
  padding:14px;
  -webkit-overflow-scrolling:touch;
}

/* EDITOR */
.card {background:var(--light);border-radius:12px;padding:12px;margin-bottom:14px;}
.title-box{font-weight:700;color:var(--text);margin-bottom:8px}
#noteTitle{
  font-size:1rem;
  font-weight:700;
  color:var(--text);
  background:transparent;
  border:none;
  outline:none;
  width:100%;
}
.note-area{
  height:110px;border-radius:10px;padding:12px;border:none;
  resize:none;font-size:0.95rem;color:#123;background:rgba(255,255,255,0.6);
}

/* mood */
.mood-row{display:flex;gap:12px;margin:10px 0 18px;align-items:center}
.mood-row span{font-size:22px;cursor:pointer;opacity:.45;transition:.12s}
.mood-row span.active{opacity:1;transform:scale(1.08)}

/* time */
.time-section{margin-bottom:14px}
.time-label{font-weight:700;color:var(--text);margin-bottom:8px}
.time-row{display:flex;gap:12px;align-items:center}
.time-box{background:rgba(255,255,255,0.75);padding:8px 10px;border-radius:10px;min-width:72px;text-align:center}
.time-val{font-weight:700;font-size:18px;color:var(--text);margin-bottom:4px}
.tiny{font-size:12px;color:#456}
.updown-col{display:flex;flex-direction:column;gap:6px}
.updown-btn{
  width:34px;height:28px;border-radius:8px;border:none;
  background:rgba(109,168,255,0.15);cursor:pointer;color:var(--accent);font-weight:700;
}

/* tags */
.input-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.input-row input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(12,70,120,0.06)}
.add-btn{padding:8px 10px;border-radius:8px;border:none;background:rgba(109,168,255,0.18);color:var(--accent);cursor:pointer}
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
.tag{background:#fff;padding:6px 10px;border-radius:14px;border:1px solid rgba(12,70,120,0.05);display:flex;align-items:center;gap:8px}
.tag button{border:none;background:transparent;cursor:pointer;color:var(--accent);font-weight:700}

/* save */
.save-btn{
  display:block;width:100%;padding:12px;border-radius:12px;border:none;
  background:var(--accent);color:white;font-weight:700;margin:18px 0;cursor:pointer;
}

/* bottom nav */
.bottom-nav{
  height:64px;background:white;border-top-left-radius:14px;border-top-right-radius:14px;
  display:flex;align-items:center;justify-content:space-around;padding:8px 14px;
  box-shadow:0 -6px 18px rgba(0,0,0,0.06)
}
.nav-icon{width:48px;height:48px;border-radius:16px;display:flex;align-items:center;justify-content:center;background:transparent;color:#7b8ea7}
.nav-icon.active{background:var(--accent);color:white;box-shadow:0 6px 16px rgba(109,168,255,0.24)}

</style>
</head>
<body>

<div class="app">

<!-- HEADER -->
<header class="app-header">
  <div class="left">
    <button onclick="window.location.href='journal.html'" style="background:none;border:none;font-size:18px;cursor:pointer">
      <i class="fas fa-arrow-left"></i>
    </button>
  </div>
  <div class="center">New Entry</div>
  <div class="right"></div>
</header>

<!-- EDITOR BODY -->
<main>

  <div class="card">
    <div class="title-box"> 
      <div contenteditable="true" id="noteTitle">Title</div>
    </div>
    <textarea id="topNote" class="note-area" placeholder="Write your journal entry..."></textarea>
  </div>

  <div style="font-weight:700;color:var(--text);margin-bottom:8px">How are you feeling?</div>
  <div class="mood-row" id="moodRow">
    <span data-i="0">üòÑ</span>
    <span data-i="1">üôÇ</span>
    <span data-i="2">üòê</span>
    <span data-i="3">üòü</span>
    <span data-i="4">üò°</span>
  </div>

  <!-- Sleep -->
  <div class="time-section">
    <div class="time-label">Sleep Hours</div>
    <div class="time-row">
      <div class="updown-col">
        <button class="updown-btn" data-for="sleepH" data-dir="up">‚ñ≤</button>
        <button class="updown-btn" data-for="sleepH" data-dir="down">‚ñº</button>
      </div>
      <div class="time-box">
        <div class="time-val" id="sleepH">8</div>
        <div class="tiny">hrs</div>
      </div>

      <div class="updown-col">
        <button class="updown-btn" data-for="sleepM" data-dir="up">‚ñ≤</button>
        <button class="updown-btn" data-for="sleepM" data-dir="down">‚ñº</button>
      </div>
      <div class="time-box">
        <div class="time-val" id="sleepM">0</div>
        <div class="tiny">min</div>
      </div>
    </div>
  </div>

  <!-- Exercise -->
  <div class="time-section">
    <div class="time-label">Exercise Time</div>
    <div class="time-row">
      <div class="updown-col">
        <button class="updown-btn" data-for="exH" data-dir="up">‚ñ≤</button>
        <button class="updown-btn" data-for="exH" data-dir="down">‚ñº</button>
      </div>
      <div class="time-box">
        <div class="time-val" id="exH">0</div>
        <div class="tiny">hrs</div>
      </div>

      <div class="updown-col">
        <button class="updown-btn" data-for="exM" data-dir="up">‚ñ≤</button>
        <button class="updown-btn" data-for="exM" data-dir="down">‚ñº</button>
      </div>
      <div class="time-box">
        <div class="time-val" id="exM">30</div>
        <div class="tiny">min</div>
      </div>
    </div>
  </div>

  <!-- Challenges -->
  <div style="margin-top:6px;font-weight:700;color:var(--text)">Challenges</div>
  <div class="input-row">
    <input id="challengeInput" placeholder="Add challenge...">
    <button class="add-btn" id="addChallengeBtn">Add</button>
  </div>
  <div class="tags" id="challengeTags"></div>

  <!-- Wins -->
  <div style="margin-top:6px;font-weight:700;color:var(--text)">Wins</div>
  <div class="input-row">
    <input id="winInput" placeholder="Add win...">
    <button class="add-btn" id="addWinBtn">Add</button>
  </div>
  <div class="tags" id="winTags"></div>

  <!-- Extra Notes -->
  <div style="margin-top:6px;font-weight:700;color:var(--text)">Additional Notes</div>
  <div class="input-row">
    <input id="noteInput" placeholder="Add note...">
    <button class="add-btn" id="addNoteBtn">Add</button>
  </div>
  <div class="tags" id="noteTags"></div>

  <button class="save-btn" id="saveBtn">Save Entry</button>

</main>

<!-- NAV -->
<div class="bottom-nav">
  <div class="nav-icon" onclick="window.location.href='home.html'"><i class="fas fa-home"></i></div>
  <div class="nav-icon"><i class="fas fa-gamepad"></i></div>
  <div class="nav-icon active" onclick="window.location.href='journal.html'"><i class="fas fa-book"></i></div>
  <div class="nav-icon"><i class="fas fa-lightbulb"></i></div>
  <div class="nav-icon"><i class="fas fa-user-circle"></i></div>
</div>

</div>
<script type ="module">
// üî• Firebase Imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// üî• Your Firebase Config (paste YOUR config here)
const firebaseConfig = {
  apiKey: "AIzaSyD9bnmF1N44Nkuk3WZQjK9z4gRE00VRmCY",
  authDomain: "mindflex-b2a0c.firebaseapp.com",
  projectId: "mindflex-b2a0c",
  storageBucket: "mindflex-b2a0c.firebasestorage.app",
  messagingSenderId: "148676867562",
  appId: "1:148676867562:web:3365a72b6fa6b3751cee93",
  measurementId: "G-Q2T6HD3S0E"
};


// üî• Initialize
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

// üî• Check if user is logged in
onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
  } else {
    alert("You must be logged in to save an entry.");
    window.location.href = "login.html"; // change if needed
  }
});


// SAME SCRIPT LOGIC AS ORIGINAL FILE (but only save functionality)

const STORAGE_KEY = 'journalEntries_v1';

let selectedMood = null;

/* ---- Tag Functions ---- */
function createTagElement(text, container){
  const el = document.createElement('div');
  el.className = 'tag';
  el.innerHTML = `<span>${text}</span><button>‚úï</button>`;
  el.querySelector('button').onclick = () => el.remove();
  container.appendChild(el);
}
function getTags(container){
  return Array.from(container.querySelectorAll(".tag span")).map(e => e.textContent);
}

/* ---- Mood ---- */
document.querySelectorAll("#moodRow span").forEach(s=>{
  s.onclick = ()=>{
    document.querySelectorAll("#moodRow span").forEach(x=>x.classList.remove("active"));
    s.classList.add("active");
    selectedMood = parseInt(s.dataset.i);
  };
});

/* ---- Up/Down ---- */
document.querySelectorAll(".updown-btn").forEach(btn=>{
  btn.onclick = ()=>{
    let id = btn.dataset.for;
    let el = document.getElementById(id);
    let val = parseInt(el.textContent);
    if(btn.dataset.dir === "up") val++;
    else val--;
    if(id.endsWith("M")){
      if(val > 59) val = 0;
      if(val < 0) val = 59;
    } else if(val < 0) val = 0;
    el.textContent = val;
  };
});

/* ---- Add Tags ---- */
addChallengeBtn.onclick = ()=>{
  if(!challengeInput.value.trim()) return;
  createTagElement(challengeInput.value.trim(), challengeTags);
  challengeInput.value = '';
};
addWinBtn.onclick = ()=>{
  if(!winInput.value.trim()) return;
  createTagElement(winInput.value.trim(), winTags);
  winInput.value = '';
};
addNoteBtn.onclick = ()=>{
  if(!noteInput.value.trim()) return;
  createTagElement(noteInput.value.trim(), noteTags);
  noteInput.value = '';
};

/* ---- SAVE ---- */
saveBtn.onclick = async () => {

  if (!currentUser) {
    alert("User not logged in.");
    return;
  }

  const entry = {
    title: noteTitle.textContent.trim() || "Untitled",
    content: topNote.value,
    mood: selectedMood,
    sleepHours: parseInt(sleepH.textContent),
    sleepMins: parseInt(sleepM.textContent),
    exerciseHours: parseInt(exH.textContent),
    exerciseMins: parseInt(exM.textContent),
    challenges: getTags(challengeTags),
    wins: getTags(winTags),
    notes: getTags(noteTags),
    savedAt: new Date(),
    userId: currentUser.uid
  };

  try {
  await addDoc(collection(db, "users", currentUser.uid, "journal"), entry);


    alert("Entry Saved!");
    window.location.href = "journal.html";
  } catch (error) {
    console.error("Error saving entry:", error);
    alert("Error saving entry.");
  }
};
</script>

</body>
</html>